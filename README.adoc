= SQL Redis
:linkattrs:
:project-owner:   redis-field-engineering
:project-name:    trino-redisearch
:project-group:   com.redis
:project-version: 0.1.2

image:https://github.com/{project-owner}/sql-redis/actions/workflows/early-access.yml/badge.svg["Build Status", link="https://github.com/{project-owner}/{project-name}/actions/workflows/early-access.yml"]
image:https://img.shields.io/maven-central/v/{project-group}/{project-name}[Download, link="https://search.maven.org/#search|ga|1|{project-name}"]
image:https://img.shields.io/nexus/s/{project-group}/{project-name}?server=https%3A%2F%2Fs01.oss.sonatype.org[Snapshot,link="https://s01.oss.sonatype.org/#nexus-search;quick~{project-name}"]
image:https://codecov.io/gh/{project-owner}/sql-redis/branch/master/graph/badge.svg?token=9I4H9NOBRQ["Coverage", link="https://codecov.io/gh/{project-owner}/sql-redis"]

SQL Redis is a SQL interface to https://oss.redislabs.com/redisearch/[RediSearch] implemented as a https://trino.io[Trino] connector.

== Docker Example

1. Launch the containers
+
[source,console]
----
docker-compose up
----

2. Create a RediSearch index
+
[source,console]
----
docker exec redismod /usr/local/bin/redis-cli FT.CREATE beers ON HASH PREFIX 1 beer: SCHEMA id TAG SORTABLE brewery_id TAG SORTABLE name TEXT SORTABLE abv NUMERIC SORTABLE descript TEXT style_name TAG SORTABLE cat_name TAG SORTABLE
----

3. Add documents to the index
+
[source,console]
----
docker run jruaux/riot-file -h host.docker.internal import http://developer.redis.com/riot/beers.json hset --keyspace beer --keys id
----

4. Run the Trino CLI
+
[source,console]
----
docker exec -it trino trino --catalog redisearch --schema default
----

5. Run a SQL query
+
[source,console]
----
trino:default> select * from beers;
----

== Install and Run

=== Install Trino

https://trino.io/docs/current/installation.html

For macOS: `brew install trino`

=== Install the connector

1. Download latest https://github.com/redis-field-engineering/sql-redis/releases/latest[release].

2. Unzip the release without any directory structure under `<trino>/plugin/redisearch`:
+
[source,console,subs="verbatim,attributes"]
----
unzip -j trino-redisearch-{project-version}.zip -d /opt/trino/plugin/redisearch
----

3. Create a `redisearch.properties` file under `<trino>/etc/catalog` directory:
+
.redisearch.properties
[source,properties]
----
connector.name=redisearch
redisearch.uri=redis://localhost:6379
----

=== Run

1. Start Trino server:
+
[source,console]
----
`trino-server start`
----

2. Connect to Trino using the CLI:
+
[source,console]
----
`trino --catalog redisearch --schema default`
----

3. Run a SQL query:
+
[source,console]
----
trino:default> select count(*) from myIdx;
----

== Tableau

Follow these steps to connect Tableau: https://help.tableau.com/current/pro/desktop/en-us/examples_presto.htm

== Build

Run these commands to build the Trino connector for RediSearch from source:

[source,console]
----
git clone https://github.com/redis-field-engineering/sql-redis.git
cd sql-redis
./gradlew clean build
----
